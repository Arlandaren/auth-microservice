# AuthService Microservice

## Описание

**AuthService** — это микросервис аутентификации и авторизации, разработанный на языке **Go** с использованием **gRPC** и **JWT** (JSON Web Tokens). Сервис предоставляет API для регистрации и входа пользователей, выдавая JWT-токены для доступа к защищенным ресурсам.

## Функциональность

- **Регистрация пользователей**: Позволяет новым пользователям создавать учетные записи, указывая имя и пароль.
- **Аутентификация пользователей**: Предоставляет возможность пользователям входить в систему с использованием своего имени и пароля.
- **Выдача JWT-токенов**: При успешной регистрации или входе пользователь получает JWT-токен для доступа к защищенным методам.
- **Аутентификация запросов**: Все защищенные методы проверяют наличие и валидность JWT-токена с помощью перехватчика `AuthInterceptor`.

## Технологии

- **Go**: Язык программирования для разработки высокопроизводительных микросервисов.
- **gRPC**: Фреймворк для реализации эффективных RPC API.
- **Protocol Buffers**: Для сериализации данных в gRPC.
- **JWT**: Для генерации и проверки токенов доступа.
- **PostgreSQL**: В качестве базы данных для хранения информации о пользователях.
- **GORM**: ORM-библиотека для работы с базой данных.

## Структура проекта

```
├── cmd
│   └── main.go               // Точка входа в приложение
├── config
│   └── config.go             // Конфигурации приложения
├── internal
│   ├── service
│   │   └── service.go        // Реализация бизнес-логики
│   ├── transport
│   │   └── server.go         // Настройка и запуск gRPC сервера
│   └── repository
│       └── repository.go     // Работа с базой данных через GORM
├── pb
│   └── auth.proto            // Прото-файл gRPC сервиса
├── utils
│   ├── jwt.go                // Функции для работы с JWT
│   └── passwords.go          // Хеширование паролей
├── go.mod                    // Файл модулей Go
└── README.md                 // Описание проекта
```

## Установка и запуск

### Предварительные требования

- **Go** 1.16 или выше
- **PostgreSQL** установлен и настроен
- **protoc** (Protocol Buffers compiler) с плагинами для Go и gRPC

### Шаги установки

1. **Клонирование репозитория**

   ```bash
   git clone https://github.com/yourusername/authservice.git
   cd authservice
   ```

2. **Установка зависимостей**

   ```bash
   go mod download
   ```

3. **Настройка конфигурации**

   Создайте файл `.env` или используйте переменные окружения для настройки:

   - **DATABASE_URL**: Строка подключения к базе данных PostgreSQL.
   - **JWT_SECRET**: Секретный ключ для подписания JWT-токенов.
   - **GRPC_ADDRESS**: Адрес и порт для запуска gRPC сервера (например, `:50051`).

4. **Миграции базы данных**

   Примените миграции для создания необходимых таблиц в базе данных:

   ```bash
   go run cmd/main.go migrate
   ```

5. **Компиляция прото-файлов**

   Убедитесь, что у вас установлены `protoc` и необходимые плагины. Скомпилируйте прото-файлы:

   ```bash
   protoc -I pb/ pb/auth.proto --go_out=pb --go-grpc_out=pb
   ```

6. **Запуск приложения**

   ```bash
   go run cmd/main.go
   ```

## Использование

### Метод `Register`

Регистрация нового пользователя:

- **Параметры**:

  - `name`: уникальное имя пользователя.
  - `password`: пароль пользователя.

- **Пример запроса**:

  ```bash
  grpcurl -d '{"name": "user1", "password": "password123"}' -plaintext localhost:50051 auth_v1.AuthService/Register
  ```

### Метод `Login`

Вход существующего пользователя:

-**Параметры**:

  - `name`: имя пользователя.
  - `password`: пароль пользователя.

-**Пример запроса**:

  ```bash
  grpcurl -d '{"name": "user1", "password": "password123"}' -plaintext localhost:50051 auth_v1.AuthService/Login
  ```

- В ответе вы получите JWT-токен.

### Доступ к защищенным методам

Для вызова защищенных методов добавьте JWT-токен в метаданные запроса:

- **Формат**:

  ```
  authorization: <ваш_токен>
  ```

-**Пример использования с grpcurl**:

  ```bash
  grpcurl -H 'authorization: your_jwt_token' -plaintext localhost:50051 yourpackage.YourService/YourMethod
  ```

## Тестирование

Вы можете использовать инструменты для тестирования gRPC-сервисов:

-**grpcurl**: CLI-инструмент для вызова gRPC методов.
-**BloomRPC**: GUI-клиент для тестирования gRPC сервисов.
-**Postman**: Поддерживает gRPC запросы в последних версиях.

## Безопасность

-**Хранение паролей**: Используется алгоритм `bcrypt` для хеширования паролей перед сохранением в базе данных.
-**JWT**: Генерация и проверка JWT-токенов для аутентификации запросов.
-**Перехватчик аутентификации**: Все защищенные методы проверяются на наличие действительного JWT-токена, кроме методов `Login` и `Register`.
-**TLS (опционально)**: Возможность включения TLS для шифрования трафика между клиентом и сервером.

## Конфигурация

Конфигурационные параметры могут задаваться через переменные окружения или файл конфигурации.

-**.env пример**:

  ```
  DATABASE_URL=postgres://user:password@localhost:5432/authdb?sslmode=disable
  JWT_SECRET=your_secret_key
  GRPC_ADDRESS=:50051
  ```

## Разработка

### Генерация сертификатов TLS (опционально)


