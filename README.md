# AuthService Microservice

## Описание

**AuthService** — это микросервис аутентификации и авторизации, разработанный на языке **Go** с использованием **gRPC** и **JWT** (JSON Web Tokens). Сервис предоставляет API для регистрации и входа пользователей, выдавая JWT-токены для доступа к защищенным ресурсам.

## Функциональность

- **Регистрация пользователей**: Позволяет новым пользователям создавать учетные записи, указывая имя и пароль.
- **Аутентификация пользователей**: Предоставляет возможность пользователям входить в систему с использованием своего имени и пароля.
- **Выдача JWT-токенов**: При успешной регистрации или входе пользователь получает JWT-токен для доступа к защищенным методам.
- **Аутентификация запросов**: Все защищенные методы проверяют наличие и валидность JWT-токена с помощью перехватчика `AuthInterceptor`.

## Технологии

- **Go**: Язык программирования для разработки высокопроизводительных микросервисов.
- **gRPC**: Фреймворк для реализации эффективных RPC API.
- **Protocol Buffers**: Для сериализации данных в gRPC.
- **JWT**: Для генерации и проверки токенов доступа.
- **PostgreSQL**: В качестве базы данных для хранения информации о пользователях.
- **GORM**: ORM-библиотека для работы с базой данных.

## Структура проекта

```
├── cmd
│   └── main.go                         // Точка входа в приложение
├── internal
│   ├── service                         // Реализация бизнес-логики
│   │   ├── service.go                  // Основная логика сервиса
│   │   └── interceptor.go              // Перехватчик для аутентификации запросов
│   ├── transport                       // Транспортные слои и серверы
│   │   └── auth.go                     // Настройка и запуск gRPC сервера
│   └── repository                      // Работа с базой данных через GORM
│       └── repository.go               // Методы для доступа к данным
├── shared
│   ├── config                          // Конфигурации приложения
│   │   └── config.go
│   ├── utils                           // Вспомогательные функции
│   │   ├── jwt.go                      // Функции для работы с JWT
│   │   └── passwords.go                // Хеширование паролей
│   └── storage                         // Модели и хранилища данных
│       ├── dto
│       │   └── user.go                 // Объекты передачи данных (DTO)
│       └── postgres
│           └── postgres.go             // Инициализация и настройки PostgreSQL
├── pb
│   └── auth.proto                      // Прото-файл gRPC сервиса
├── Dockerfile                          // Dockerfile для сборки образа
├── docker-compose.yml                  // Docker Compose для запуска приложения и базы данных
├── Taskfile.yml                        // Taskfile для автоматизации задач разработки
├── go.mod                              // Файл модулей Go
└── README.md                           // Описание проекта
```

## Установка и запуск

### Предварительные требования

- **Go** 1.16 или выше
- **PostgreSQL** установлен и настроен
- **protoc** (Protocol Buffers compiler) с плагинами для Go и gRPC

### Шаги установки

1. **Клонирование репозитория**

   ```bash
   git clone https://github.com/yourusername/auth-microservice.git
   cd auth-microservice
   ```

2. **Настройка конфигурации**

   Создайте файл `.env` или используйте переменные окружения для настройки:

   - **DATABASE_URL**: Строка подключения к базе данных PostgreSQL.
   - **JWT_SECRET**: Секретный ключ для подписания JWT-токенов.
   - **GRPC_ADDRESS**: Адрес и порт для запуска gRPC сервера (например, `:50051`).

4. **Компиляция прото-файлов**


   ```bash
   task generate
   ```

6. **Запуск приложения**

   ```bash
   docker-compose up -d
   ```

## Использование

### Метод `Register`

Регистрация нового пользователя:

- **Параметры**:

  - `name`: уникальное имя пользователя.
  - `password`: пароль пользователя.

- **Пример запроса**:

  ```bash
  grpcurl -d '{"name": "user1", "password": "password123"}' -plaintext localhost:50051 auth_v1.AuthService/Register
  ```

### Метод `Login`

Вход существующего пользователя:

-**Параметры**:

  - `name`: имя пользователя.
  - `password`: пароль пользователя.

-**Пример запроса**:

  ```bash
  grpcurl -d '{"name": "user1", "password": "password123"}' -plaintext localhost:50051 auth_v1.AuthService/Login
  ```

- В ответе вы получите JWT-токен.

### Доступ к защищенным методам

Для вызова защищенных методов добавьте JWT-токен в метаданные запроса:

- **Формат**:

  ```
  authorization: <ваш_токен>
  ```

-**Пример использования с grpcurl**:

  ```bash
  grpcurl -H 'authorization: your_jwt_token' -plaintext localhost:50051 yourpackage.YourService/YourMethod
  ```

## Тестирование

Вы можете использовать инструменты для тестирования gRPC-сервисов:

-**grpcurl**: CLI-инструмент для вызова gRPC методов.
-**BloomRPC**: GUI-клиент для тестирования gRPC сервисов.
-**Postman**: Поддерживает gRPC запросы в последних версиях.

## Безопасность

-**Хранение паролей**: Используется алгоритм `bcrypt` для хеширования паролей перед сохранением в базе данных.
-**JWT**: Генерация и проверка JWT-токенов для аутентификации запросов.
-**Перехватчик аутентификации**: Все защищенные методы проверяются на наличие действительного JWT-токена, кроме методов `Login` и `Register`.
-**TLS (опционально)**: Возможность включения TLS для шифрования трафика между клиентом и сервером.

## Конфигурация

Конфигурационные параметры могут задаваться через переменные окружения или файл конфигурации.

-**.env пример**:

  ```
  DATABASE_URL=postgres://user:password@localhost:5432/authdb?sslmode=disable
  JWT_SECRET=your_secret_key
  GRPC_ADDRESS=:50051
  ```

## Разработка

### Генерация сертификатов TLS (опционально)


